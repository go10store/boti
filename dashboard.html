<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุญุฉ ุชุญูู ุงูุณุงุฆู - ุจูุทู</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header class="site-header">
        <div class="container nav-content">
            <div class="logo">
                <span style="color:var(--text-main)">ุฅุฏุงุฑุฉ</span> ุงูููุดูุฑ
            </div>
            <a href="index.html" class="btn btn-secondary">ุงูุฎุฑูุฌ</a>
        </div>
    </header>

    <main class="container" style="max-width: 500px; margin-top: 4rem;">

        <!-- Login Section -->
        <div id="login-section" class="card fade-in">
            <h2 style="text-align: center; margin-bottom: 1.5rem; color: var(--accent);">ุชุณุฌูู ุงูุฏุฎูู</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>ุฑูู ุงููุงุชู</label>
                    <input type="tel" name="phone" class="form-control" required placeholder="091 xxx">
                </div>
                <div class="form-group">
                    <label>ูููุฉ ุงููุฑูุฑ</label>
                    <div class="input-wrapper">
                        <input type="password" id="passwordInput" name="password" class="form-control" required
                            placeholder="****">
                        <button type="button" class="input-icon-btn" onclick="togglePin('passwordInput')">๐๏ธ</button>
                    </div>
                </div>
                <div style="text-align: left; margin-bottom: 1.5rem;">
                    <a href="https://wa.me/218910000000" target="_blank"
                        style="font-size: 0.85rem; color: var(--text-sub);">ูุณูุช ุงูุฑูู ุงูุณุฑูุ</a>
                </div>
                <button type="submit" class="btn btn-primary" style="width:100%">ุฏุฎูู</button>
            </form>
        </div>

        <script>
            function togglePin(id) {
                const input = document.getElementById(id);
                if (input.type === 'password') input.type = 'text';
                else input.type = 'password';
            }
        </script>

        <!-- Dashboard Section (Hidden by default) -->
        <div id="dashboard-section" class="card slide-up" style="display: none;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 id="driverName" style="color: var(--accent);">ูุฑุญุจุงูุ ุนูู</h2>
                <p style="color: var(--text-sub);">ุชุญูู ูู ุญุงูุฉ ููุดูุฑู</p>
            </div>

            <div class="form-group">
                <label>ุงูุญุงูุฉ ุงูุญุงููุฉ:</label>
                <div id="status-buttons" style="display: grid; gap: 1rem;">
                    <button onclick="changeStatus('AVAILABLE')" class="btn"
                        style="background: var(--success); color: #fff;">๐ข ูุชุงุญ (Available)</button>
                    <button onclick="changeStatus('EN_ROUTE')" class="btn" style="background: #F59E0B; color: #fff;">๐ก
                        ูู ุงูุทุฑูู</button>
                    <button onclick="changeStatus('BUSY')" class="btn" style="background: var(--error); color: #fff;">๐ด
                        ุชู ุงูุจูุน / ูุดุบูู</button>
                </div>
            </div>

            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--glass-border);">
                <p style="text-align: center; font-size: 0.9rem; color: var(--text-sub);">ุณูุชู ุชุบููุฑ ุญุงูุชู ููุฑุงู ูู
                    ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</p>
            </div>

            <!-- Account Management -->
            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--glass-border);">
                <h3 style="color: var(--text-main); margin-bottom: 1rem; font-size: 1.1rem;">ุฅุฏุงุฑุฉ ุงูุญุณุงุจ</h3>
                <div style="display: grid; gap: 0.8rem;">
                    <button onclick="logout()" class="btn btn-secondary" style="width:100%">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                    <button onclick="deleteAccount()" class="btn"
                        style="width:100%; background: var(--error); color: white;">๐๏ธ ุทูุจ ุญุฐู ุงูุญุณุงุจ</button>
                </div>
            </div>
        </div>

    </main>

    <script src="app.js"></script>
    <script>
        let currentDriver = null;

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = e.target.phone.value;
            const password = e.target.password.value;

            // Simple client-side auth for demo
            currentDriver = await loginDriver(phone, password);

            if (currentDriver) {
                showNotification('ุชู ุชุณุฌูู ุงูุฏุฎูู!', 'success');
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('dashboard-section').style.display = 'block';
                document.getElementById('driverName').innerText = `ูุฑุญุจุงูุ ${currentDriver.name}`;
            } else {
                showNotification('ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ', 'error');
            }
        });

        async function changeStatus(status) {
            if (!currentDriver) return;
            const success = await updateDriverStatus(currentDriver.id, status);
            if (success) {
                showNotification('ุชู ุชุญุฏูุซ ุงูุญุงูุฉ ุจูุฌุงุญ!', 'success');
            } else {
                showNotification('ูุดู ุงูุชุญุฏูุซ', 'error');
            }
        }

        function logout() {
            currentDriver = null;
            document.getElementById('dashboard-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('loginForm').reset();
            showNotification('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ', 'info');
        }

        async function deleteAccount() {
            if (!currentDriver) return;
            if (!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุทูุจ ุญุฐู ุญุณุงุจูุ ุณูุชู ุฅุฑุณุงู ุงูุทูุจ ููุฅุฏุงุฑุฉ ูููุฑุงุฌุนุฉ.')) return;

            const result = await requestAccountDeletion(currentDriver.id);
            if (result.success) {
                showNotification(result.message, 'success');
                setTimeout(() => {
                    logout();
                }, 2000);
            } else {
                showNotification(result.message || 'ูุดู ุฅุฑุณุงู ุงูุทูุจ', 'error');
            }
        }
    </script>
</body>

</html>